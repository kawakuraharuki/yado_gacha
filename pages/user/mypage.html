<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚¤ãƒšãƒ¼ã‚¸ - å®¿ã‚¬ãƒãƒ£</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <button class="menu-button" id="menuButton">â˜°</button>
                <img src="../../assets/images/logo.png" alt="å®¿ã‚¬ãƒãƒ£" class="logo-image">
            </div>
            <nav class="nav-links">
                <a href="mypage.html" style="background: rgba(255,255,255,0.2);">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
            </nav>
        </div>
    </header>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="menu-modal" id="menuModal">
        <div class="menu-content">
            <div class="menu-header">
                <h2>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
                <button class="menu-close" id="menuClose">âœ•</button>
            </div>
            
            <div class="menu-section">
                <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘</h3>
                <a href="../../index.html" class="menu-item">
                    <span class="menu-item-icon">ğŸ </span>
                    <span>ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</span>
                </a>
                <a href="mypage.html" class="menu-item">
                    <span class="menu-item-icon">ğŸ‘¤</span>
                    <span>ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
                </a>
            </div>
            
            <div class="menu-section">
                <h3>ãƒ›ãƒ†ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å‘ã‘</h3>
                <a href="../partner/dashboard.html" class="menu-item">
                    <span class="menu-item-icon">ğŸ“Š</span>
                    <span>ç®¡ç†ç”»é¢</span>
                </a>
            </div>
            
            <div class="menu-footer">
                <button class="logout-button" onclick="handleLogout()">
                    <span class="menu-item-icon">ğŸšª</span>
                    <span>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
                </button>
            </div>
        </div>
    </div>

    <main class="container">
        <div class="card">
            <h1 style="margin-bottom: 5px;">ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
            <p style="color: #666;">user_001 ã•ã‚“</p>
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn btn-secondary tab-btn active" data-tab="upcoming">
                ä»Šå¾Œã®äºˆç´„
            </button>
            <button class="btn btn-secondary tab-btn" data-tab="past">
                éå»ã®äºˆç´„
            </button>
        </div>

        <!-- ä»Šå¾Œã®äºˆç´„ -->
        <div id="upcomingTab" class="tab-content">
            <div id="upcomingReservations" class="reservation-list">
                <!-- äºˆç´„ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
            <div id="noUpcomingReservations" style="display: none;">
                <div class="card" style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“…</div>
                    <h3 style="margin-bottom: 10px;">äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</h3>
                    <p style="color: #666; margin-bottom: 20px;">æ–°ã—ã„å®¿ã‚¬ãƒãƒ£ã‚’å›ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
                    <button class="btn btn-primary" onclick="window.location.href='../../index.html'">
                        å®¿ã‚¬ãƒãƒ£ã‚’å›ã™
                    </button>
                </div>
            </div>
        </div>

        <!-- éå»ã®äºˆç´„ -->
        <div id="pastTab" class="tab-content" style="display: none;">
            <div id="pastReservations" class="reservation-list">
                <!-- äºˆç´„ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
            <div id="noPastReservations" style="display: none;">
                <div class="card" style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“</div>
                    <h3 style="margin-bottom: 10px;">éå»ã®äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</h3>
                    <p style="color: #666;">å®¿ã‚¬ãƒãƒ£ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ã“ã“ã«å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                </div>
            </div>
        </div>
    </main>

    <script src="../../js/data.js"></script>
    <script src="../../js/menu.js"></script>
    <script>
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                
                this.classList.add('active');
                document.getElementById(this.dataset.tab + 'Tab').style.display = 'block';
            });
        });

        // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const reservations = getReservations();
        const hotels = getHotels();
        const userId = getCurrentUser();
        const userReservations = reservations.filter(r => r.userId === userId);

        const today = new Date();
        today.setHours(0, 0, 0, 0);

        // ä»Šå¾Œã®äºˆç´„ã¨éå»ã®äºˆç´„ã‚’åˆ†ã‘ã‚‹
        const upcomingReservations = userReservations.filter(r => {
            const checkInDate = new Date(r.checkInDate);
            return checkInDate >= today;
        }).sort((a, b) => new Date(a.checkInDate) - new Date(b.checkInDate));

        const pastReservations = userReservations.filter(r => {
            const checkInDate = new Date(r.checkInDate);
            return checkInDate < today;
        }).sort((a, b) => new Date(b.checkInDate) - new Date(a.checkInDate));

        // ä»Šå¾Œã®äºˆç´„ã‚’è¡¨ç¤º
        if (upcomingReservations.length > 0) {
            const upcomingContainer = document.getElementById('upcomingReservations');
            upcomingReservations.forEach(reservation => {
                const hotel = hotels.find(h => h.id === reservation.hotelId);
                upcomingContainer.appendChild(createReservationCard(reservation, hotel, true));
            });
        } else {
            document.getElementById('noUpcomingReservations').style.display = 'block';
        }

        // éå»ã®äºˆç´„ã‚’è¡¨ç¤º
        if (pastReservations.length > 0) {
            const pastContainer = document.getElementById('pastReservations');
            pastReservations.forEach(reservation => {
                const hotel = hotels.find(h => h.id === reservation.hotelId);
                pastContainer.appendChild(createReservationCard(reservation, hotel, false));
            });
        } else {
            document.getElementById('noPastReservations').style.display = 'block';
        }

        // äºˆç´„ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
        function createReservationCard(reservation, hotel, isUpcoming) {
            const card = document.createElement('div');
            card.className = 'reservation-card';
            
            const checkInDate = new Date(reservation.checkInDate);
            const checkOutDate = new Date(reservation.checkInDate);
            checkOutDate.setDate(checkOutDate.getDate() + reservation.nights);
            
            const isPending = reservation.status === 'pending';
            const revealDate = new Date(reservation.revealDate);
            const now = new Date();
            const shouldReveal = !isPending || now >= revealDate;

            let cardContent = `
                <div class="reservation-header">
                    <div>
                        <h3 style="margin-bottom: 5px;">${shouldReveal && hotel ? hotel.name : 'ğŸ å½“æ—¥ç™ºè¡¨äºˆå®š'}</h3>
                        <p style="color: #666; font-size: 0.9rem;">äºˆç´„ç•ªå·: ${reservation.id}</p>
                    </div>
                    <span class="reservation-status ${reservation.status === 'cancelled' ? 'status-cancelled' : isPending ? 'status-pending' : 'status-revealed'}">
                        ${reservation.status === 'cancelled' ? 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿' : isPending ? 'æœªç™ºè¡¨' : 'ç¢ºå®š'}
                    </span>
                </div>
                
                <div style="margin-top: 15px; display: grid; gap: 8px; font-size: 0.95rem;">
                    <div><strong>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³:</strong> ${checkInDate.toLocaleDateString('ja-JP')}</div>
                    <div><strong>ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ:</strong> ${checkOutDate.toLocaleDateString('ja-JP')}</div>
                    <div><strong>å®¿æ³Šæ•°:</strong> ${reservation.nights}æ³Š</div>
                    <div><strong>äººæ•°:</strong> ${reservation.guests}å</div>
                    <div><strong>æ–™é‡‘:</strong> Â¥${reservation.price.toLocaleString()}</div>
                    ${reservation.attempts > 1 ? `<div style="color: #f5576c;"><strong>ã‚¬ãƒãƒ£å›æ•°:</strong> ${reservation.attempts}å›</div>` : ''}
                </div>
            `;

            if (reservation.status === 'cancelled') {
                cardContent += `
                    <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                        <p style="color: #856404; margin: 0;">ã“ã®äºˆç´„ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ</p>
                        ${reservation.cancelledAt ? `<p style="color: #856404; font-size: 0.9rem; margin-top: 5px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ—¥: ${new Date(reservation.cancelledAt).toLocaleDateString('ja-JP')}</p>` : ''}
                    </div>
                `;
            } else if (shouldReveal && hotel) {
                cardContent += `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                        <div style="display: grid; gap: 8px; font-size: 0.9rem; color: #666;">
                            <div>ğŸ“ ${hotel.address}</div>
                            <div>ğŸ“ ${hotel.phone}</div>
                            <div>ğŸ• ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³: ${hotel.checkIn} / ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ: ${hotel.checkOut}</div>
                        </div>
                    </div>
                `;
            } else if (isPending && isUpcoming) {
                const daysUntilReveal = Math.ceil((revealDate - now) / (1000 * 60 * 60 * 24));
                cardContent += `
                    <div class="countdown" style="margin-top: 15px;">
                        <p style="margin-bottom: 10px;">å®¿æ³Šå…ˆç™ºè¡¨ã¾ã§</p>
                        <div class="countdown-number">${daysUntilReveal}</div>
                        <p>æ—¥</p>
                    </div>
                `;
            }

            card.innerHTML = cardContent;
            return card;
        }
    </script>
</body>
</html>