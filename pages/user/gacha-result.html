<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¬ãƒãƒ£çµæœ - å®¿ã‚¬ãƒãƒ£</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="../../index.html" class="logo">ğŸ¨ å®¿ã‚¬ãƒãƒ£</a>
            <nav class="nav-links">
                <a href="mypage.html">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
                <a href="../partner/dashboard.html">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- ã™ãã‚ã‹ã‚‹ã‚¬ãƒãƒ£ã®å ´åˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div id="gachaAnimation" class="gacha-container" style="display: none;">
            <div class="gacha-box spinning">
                <div class="question-mark">?</div>
            </div>
            <h2 style="color: #667eea;">ã‚¬ãƒãƒ£ã‚’å›ã—ã¦ã„ã¾ã™...</h2>
        </div>

        <!-- å½“æ—¥ã‚ã‹ã‚‹ã‚¬ãƒãƒ£ã®å ´åˆã®è¡¨ç¤º -->
        <div id="pendingResult" class="card" style="display: none;">
            <div style="text-align: center; padding: 40px;">
                <div style="font-size: 5rem; margin-bottom: 20px;">ğŸ</div>
                <h1 style="color: #667eea; margin-bottom: 20px;">äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼</h1>
                <p style="font-size: 1.2rem; margin-bottom: 30px;">
                    å®¿æ³Šå…ˆã¯<span id="revealDate" style="color: #f5576c; font-weight: bold;"></span>ã«ç™ºè¡¨ã•ã‚Œã¾ã™
                </p>
                <div class="countdown">
                    <p style="margin-bottom: 10px;">ç™ºè¡¨ã¾ã§</p>
                    <div class="countdown-number" id="countdownDays">--</div>
                    <p>æ—¥</p>
                </div>
                <button class="btn btn-primary" style="margin-top: 30px;" onclick="window.location.href='mypage.html'">
                    ãƒã‚¤ãƒšãƒ¼ã‚¸ã§è©³ç´°ã‚’ç¢ºèª
                </button>
            </div>
        </div>

        <!-- çµæœè¡¨ç¤º -->
        <div id="resultContainer" class="result-container" style="display: none;">
            <div class="card">
                <h1 style="text-align: center; color: #667eea; margin-bottom: 30px;">
                    ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼
                </h1>
                
                <img id="hotelImage" class="hotel-image" src="" alt="">
                
                <div class="hotel-info">
                    <h2 id="hotelName"></h2>
                    
                    <div class="hotel-meta">
                        <div class="meta-item">
                            <span>ğŸ“</span>
                            <span id="hotelAddress"></span>
                        </div>
                        <div class="meta-item">
                            <span>ğŸ“</span>
                            <span id="hotelPhone"></span>
                        </div>
                        <div class="meta-item">
                            <span>ğŸ•</span>
                            <span>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³: <span id="checkInTime"></span></span>
                        </div>
                        <div class="meta-item">
                            <span>ğŸ•‘</span>
                            <span>ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ: <span id="checkOutTime"></span></span>
                        </div>
                    </div>
                    
                    <p id="hotelDescription" style="margin-top: 20px; line-height: 1.8; color: #666;"></p>
                    
                    <div class="features-grid" id="featuresGrid">
                        <!-- ç‰¹å¾´ã‚¿ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px;">ğŸ“‹ äºˆç´„è©³ç´°</h3>
                <div id="reservationDetails">
                    <!-- äºˆç´„è©³ç´°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="window.location.href='mypage.html'">
                    ãƒã‚¤ãƒšãƒ¼ã‚¸ã§äºˆç´„ã‚’ç¢ºèª
                </button>
                <button class="btn btn-secondary" onclick="window.location.href='../../index.html'" style="margin-left: 10px;">
                    ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸
                </button>
            </div>
        </div>
    </main>

    <script src="../../js/data.js"></script>
    <script>
        const reservationId = sessionStorage.getItem('latestReservationId');
        
        if (!reservationId) {
            window.location.href = '../../index.html';
        }

        // äºˆç´„æƒ…å ±ã‚’å–å¾—
        const reservations = getReservations();
        const reservation = reservations.find(r => r.id === reservationId);
        
        if (!reservation) {
            window.location.href = '../../index.html';
        }

        // ãƒ›ãƒ†ãƒ«æƒ…å ±ã‚’å–å¾—
        const hotels = getHotels();
        const hotel = hotels.find(h => h.id === reservation.hotelId);

        // å³åº§ã«çµæœã‚’è¡¨ç¤ºã™ã‚‹ã‹ã€å½“æ—¥ã¾ã§å¾…ã¤ã‹
        if (reservation.planType === 'instant') {
            // ã™ãã‚ã‹ã‚‹ã‚¬ãƒãƒ£ã®å ´åˆ
            showGachaAnimation();
        } else {
            // å½“æ—¥ã‚ã‹ã‚‹ã‚¬ãƒãƒ£ã®å ´åˆ
            showPendingResult();
        }

        function showGachaAnimation() {
            document.getElementById('gachaAnimation').style.display = 'block';
            
            // 2ç§’å¾Œã«çµæœã‚’è¡¨ç¤º
            setTimeout(() => {
                document.getElementById('gachaAnimation').style.display = 'none';
                showResult();
            }, 2000);
        }

        function showPendingResult() {
            document.getElementById('pendingResult').style.display = 'block';
            
            const revealDate = new Date(reservation.revealDate);
            document.getElementById('revealDate').textContent = revealDate.toLocaleDateString('ja-JP');
            
            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¨ˆç®—
            const now = new Date();
            const daysUntilReveal = Math.ceil((revealDate - now) / (1000 * 60 * 60 * 24));
            document.getElementById('countdownDays').textContent = daysUntilReveal;
        }

        function showResult() {
            document.getElementById('resultContainer').style.display = 'block';
            
            // ãƒ›ãƒ†ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
            document.getElementById('hotelImage').src = hotel.image;
            document.getElementById('hotelImage').alt = hotel.name;
            document.getElementById('hotelName').textContent = hotel.name;
            document.getElementById('hotelAddress').textContent = hotel.address;
            document.getElementById('hotelPhone').textContent = hotel.phone;
            document.getElementById('checkInTime').textContent = hotel.checkIn;
            document.getElementById('checkOutTime').textContent = hotel.checkOut;
            document.getElementById('hotelDescription').textContent = hotel.description;
            
            // ç‰¹å¾´ã‚¿ã‚°
            const featuresGrid = document.getElementById('featuresGrid');
            hotel.features.forEach(feature => {
                const tag = document.createElement('span');
                tag.className = 'feature-tag';
                tag.textContent = feature;
                featuresGrid.appendChild(tag);
            });
            
            // äºˆç´„è©³ç´°
            const checkInDate = new Date(reservation.checkInDate);
            const checkOutDate = new Date(reservation.checkInDate);
            checkOutDate.setDate(checkOutDate.getDate() + reservation.nights);
            
            document.getElementById('reservationDetails').innerHTML = `
                <div style="display: grid; gap: 10px; font-size: 0.95rem;">
                    <div><strong>äºˆç´„ç•ªå·:</strong> ${reservation.id}</div>
                    <div><strong>å®¿æ³Šè€…å:</strong> ${reservation.guestName}</div>
                    <div><strong>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³:</strong> ${checkInDate.toLocaleDateString('ja-JP')}</div>
                    <div><strong>ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ:</strong> ${checkOutDate.toLocaleDateString('ja-JP')}</div>
                    <div><strong>å®¿æ³Šæ•°:</strong> ${reservation.nights}æ³Š</div>
                    <div><strong>äººæ•°:</strong> ${reservation.guests}å</div>
                    <div><strong>æ–™é‡‘:</strong> Â¥${reservation.price.toLocaleString()}</div>
                </div>
            `;
        }
    </script>
</body>
</html>