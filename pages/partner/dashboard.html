<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†ç”»é¢ - å®¿ã‚¬ãƒãƒ£</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <button class="menu-button" id="menuButton">â˜°</button>
                <a href="../../index.html" class="logo">
                    <img src="../../assets/images/logo.png" alt="å®¿ã‚¬ãƒãƒ£" class="logo-image">
                </a>
            </div>
            <nav class="nav-links">
                <a href="#" onclick="alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ'); window.location.href='../../index.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            </nav>
        </div>
    </header>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="menu-modal" id="menuModal">
        <div class="menu-content">
            <div class="menu-header">
                <h2>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
                <button class="menu-close" id="menuClose">âœ•</button>
            </div>
            
            <div class="menu-section">
                <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘</h3>
                <a href="../../index.html" class="menu-item">
                    <span class="menu-item-icon">ğŸ </span>
                    <span>ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</span>
                </a>
                <a href="../user/mypage.html" class="menu-item">
                    <span class="menu-item-icon">ğŸ‘¤</span>
                    <span>ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
                </a>
            </div>
            
            <div class="menu-section">
                <h3>ãƒ›ãƒ†ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å‘ã‘</h3>
                <a href="dashboard.html" class="menu-item">
                    <span class="menu-item-icon">ğŸ“Š</span>
                    <span>ç®¡ç†ç”»é¢</span>
                </a>
            </div>
            
            <div class="menu-footer">
                <button class="logout-button" onclick="handleLogout()">
                    <span class="menu-item-icon">ğŸšª</span>
                    <span>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
                </button>
            </div>
        </div>
    </div>

    <main class="admin-dashboard">
        <div class="card">
            <h1>æ±äº¬ãƒ™ã‚¤ã‚µã‚¤ãƒ‰ãƒ›ãƒ†ãƒ« ç®¡ç†ç”»é¢</h1>
            <p style="color: #666;">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID: hotel_001</p>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalReservations">0</div>
                <div class="stat-label">ç·äºˆç´„æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="upcomingReservations">0</div>
                <div class="stat-label">ä»Šå¾Œã®äºˆç´„</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalRevenue">Â¥0</div>
                <div class="stat-label">ç·å£²ä¸Š</div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn btn-secondary tab-btn active" data-tab="inventory">
                åœ¨åº«ç®¡ç†
            </button>
            <button class="btn btn-secondary tab-btn" data-tab="reservations">
                äºˆç´„ä¸€è¦§
            </button>
        </div>

        <!-- åœ¨åº«ç®¡ç†ã‚¿ãƒ– -->
        <div id="inventoryTab" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 20px;">åœ¨åº«ç®¡ç†</h2>
                
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="btn btn-secondary" id="prevMonth" style="padding: 8px 15px; font-size: 0.9rem;">â—€</button>
                        <h3 id="currentMonth" style="font-size: 1.2rem;"></h3>
                        <button class="btn btn-secondary" id="nextMonth" style="padding: 8px 15px; font-size: 0.9rem;">â–¶</button>
                    </div>
                    
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="margin-bottom: 15px;">åœ¨åº«ç™»éŒ²</h4>
                    <form id="inventoryForm">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="form-group">
                                <label class="form-label" for="inventoryDate">æ—¥ä»˜</label>
                                <input type="date" class="form-input" id="inventoryDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="roomCount">æä¾›éƒ¨å±‹æ•°</label>
                                <input type="number" class="form-input" id="roomCount" min="1" max="10" value="1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="roomPrice">1éƒ¨å±‹ã®å¸å€¤ï¼ˆå††ï¼‰</label>
                                <input type="number" class="form-input" id="roomPrice" min="1000" step="100" value="8000" required>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button type="submit" class="btn btn-primary">
                                åœ¨åº«ã‚’ç™»éŒ²ãƒ»æ›´æ–°
                            </button>
                            <button type="button" class="btn" id="deleteButton" style="background: #dc3545; color: white; margin-left: 10px; display: none;">
                                åœ¨åº«ã‚’å‰Šé™¤
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- äºˆç´„ä¸€è¦§ã‚¿ãƒ– -->
        <div id="reservationsTab" class="tab-content" style="display: none;">
            <div class="card">
                <h2 style="margin-bottom: 20px;">äºˆç´„ä¸€è¦§</h2>
                
                <div id="reservationsList">
                    <!-- äºˆç´„ä¸€è¦§ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                
                <div id="noReservations" style="display: none; text-align: center; padding: 40px;">
                    <p style="color: #666;">ã¾ã äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>
        </div>
    </main>

    <script src="../../js/data.js"></script>
    <script src="../../js/menu.js"></script>
    <script>
        // ç¾åœ¨ã®æœˆ
        let currentDate = new Date();
        const hotelId = 'hotel_001'; // ãƒ¢ãƒƒã‚¯ã§å›ºå®š

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                
                this.classList.add('active');
                document.getElementById(this.dataset.tab + 'Tab').style.display = 'block';
            });
        });

        // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
        function updateStats() {
            const reservations = getReservations().filter(r => r.hotelId === hotelId);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const activeReservations = reservations.filter(r => r.status !== 'cancelled');
            const upcoming = activeReservations.filter(r => new Date(r.checkInDate) >= today);
            const totalRevenue = activeReservations.reduce((sum, r) => sum + r.price, 0);
            
            document.getElementById('totalReservations').textContent = activeReservations.length;
            document.getElementById('upcomingReservations').textContent = upcoming.length;
            document.getElementById('totalRevenue').textContent = 'Â¥' + totalRevenue.toLocaleString();
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æç”»
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                `${year}å¹´${month + 1}æœˆ`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
            const weekDays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            weekDays.forEach(day => {
                const header = document.createElement('div');
                header.style.fontWeight = 'bold';
                header.style.textAlign = 'center';
                header.style.fontSize = '0.85rem';
                header.style.color = '#666';
                header.style.padding = '5px 0';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // ç©ºç™½ã‚»ãƒ«
            for (let i = 0; i < firstDay; i++) {
                grid.appendChild(document.createElement('div'));
            }
            
            // æ—¥ä»˜ã‚»ãƒ«
            const inventory = JSON.parse(localStorage.getItem('yadogacha_inventory') || '{}');
            
            for (let date = 1; date <= lastDate; date++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-day';
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const dayInventory = inventory[hotelId]?.[dateStr];
                
                if (dayInventory) {
                    cell.classList.add('has-inventory');
                    cell.innerHTML = `
                        <div class="day-number">${date}</div>
                        <div class="day-info">${dayInventory.rooms}å®¤</div>
                    `;
                } else {
                    cell.innerHTML = `<div class="day-number">${date}</div>`;
                }
                
                cell.addEventListener('click', () => {
                    document.getElementById('inventoryDate').value = dateStr;
                    if (dayInventory) {
                        document.getElementById('roomCount').value = dayInventory.rooms;
                        document.getElementById('roomPrice').value = dayInventory.price;
                        document.getElementById('deleteButton').style.display = 'inline-block';
                    } else {
                        document.getElementById('roomCount').value = 1;
                        document.getElementById('roomPrice').value = 8000;
                        document.getElementById('deleteButton').style.display = 'none';
                    }
                });
                
                grid.appendChild(cell);
            }
        }

        // æœˆã®åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        // åœ¨åº«ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ 
        document.getElementById('inventoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('inventoryDate').value;
            const rooms = parseInt(document.getElementById('roomCount').value);
            const price = parseInt(document.getElementById('roomPrice').value);
            
            // åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            let inventory = JSON.parse(localStorage.getItem('yadogacha_inventory') || '{}');
            if (!inventory[hotelId]) inventory[hotelId] = {};
            
            inventory[hotelId][date] = {
                rooms: rooms,
                price: price
            };
            
            localStorage.setItem('yadogacha_inventory', JSON.stringify(inventory));
            
            alert('åœ¨åº«ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
            renderCalendar();
            this.reset();
            document.getElementById('deleteButton').style.display = 'none';
        });

        // åœ¨åº«å‰Šé™¤ãƒœã‚¿ãƒ³
        document.getElementById('deleteButton').addEventListener('click', function() {
            const date = document.getElementById('inventoryDate').value;
            
            if (!date) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            if (confirm(`${date}ã®åœ¨åº«ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
                let inventory = JSON.parse(localStorage.getItem('yadogacha_inventory') || '{}');
                
                if (inventory[hotelId] && inventory[hotelId][date]) {
                    delete inventory[hotelId][date];
                    localStorage.setItem('yadogacha_inventory', JSON.stringify(inventory));
                    
                    alert('åœ¨åº«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                    renderCalendar();
                    document.getElementById('inventoryForm').reset();
                    document.getElementById('deleteButton').style.display = 'none';
                }
            }
        });

        // äºˆç´„ä¸€è¦§ã®è¡¨ç¤º
        function renderReservations() {
            const reservations = getReservations().filter(r => r.hotelId === hotelId);
            const container = document.getElementById('reservationsList');
            
            if (reservations.length === 0) {
                document.getElementById('noReservations').style.display = 'block';
                container.style.display = 'none';
            } else {
                document.getElementById('noReservations').style.display = 'none';
                container.style.display = 'block';
                
                container.innerHTML = reservations.map(r => {
                    const checkInDate = new Date(r.checkInDate);
                    const checkOutDate = new Date(r.checkInDate);
                    checkOutDate.setDate(checkOutDate.getDate() + r.nights);
                    
                    return `
                        <div class="reservation-card" data-reservation-id="${r.id}">
                            <div class="reservation-header">
                                <div>
                                    <h4>${r.guestName}</h4>
                                    <p style="color: #666; font-size: 0.9rem;">äºˆç´„ç•ªå·: ${r.id}</p>
                                </div>
                                <span class="reservation-status ${r.status === 'cancelled' ? 'status-cancelled' : 'status-revealed'}">
                                    ${r.status === 'cancelled' ? 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿' : 'ç¢ºå®š'}
                                </span>
                            </div>
                            <div style="margin-top: 15px; display: grid; gap: 8px; font-size: 0.95rem;">
                                <div><strong>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³:</strong> ${checkInDate.toLocaleDateString('ja-JP')}</div>
                                <div><strong>ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ:</strong> ${checkOutDate.toLocaleDateString('ja-JP')}</div>
                                <div><strong>äººæ•°:</strong> ${r.guests}å</div>
                                <div><strong>é€£çµ¡å…ˆ:</strong> ${r.phone} / ${r.email}</div>
                                ${r.specialRequests ? `<div><strong>ç‰¹åˆ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:</strong> ${r.specialRequests}</div>` : ''}
                            </div>
                            ${r.status !== 'cancelled' ? `
                                <div style="margin-top: 15px; text-align: right;">
                                    <button class="btn cancel-reservation-btn" style="background: #dc3545; color: white; padding: 8px 20px; font-size: 0.9rem;" data-reservation-id="${r.id}">
                                        äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }
        }

        // æ—¥ä»˜ã®æœ€å°å€¤ã‚’ä»Šæ—¥ã«è¨­å®š
        document.getElementById('inventoryDate').min = new Date().toISOString().split('T')[0];

        // äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½
        function setupCancelButtons() {
            document.querySelectorAll('.cancel-reservation-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reservationId = this.dataset.reservationId;
                    
                    if (confirm('ã“ã®äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                        // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                        let reservations = getReservations();
                        const reservationIndex = reservations.findIndex(r => r.id === reservationId);
                        
                        if (reservationIndex !== -1) {
                            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤‰æ›´
                            reservations[reservationIndex].status = 'cancelled';
                            reservations[reservationIndex].cancelledAt = new Date().toISOString();
                            reservations[reservationIndex].cancelledBy = 'hotel';
                            
                            // ä¿å­˜
                            localStorage.setItem('yadogacha_reservations', JSON.stringify(reservations));
                            
                            alert('äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
                            
                            // ç”»é¢ã‚’æ›´æ–°
                            updateStats();
                            renderReservations();
                            setupCancelButtons();
                        }
                    }
                });
            });
        }

        // åˆæœŸåŒ–
        updateStats();
        renderCalendar();
        renderReservations();
        setupCancelButtons();
    </script>
</body>
</html>